#!/bin/bash

CURRENT_PATH="${PWD}"
CONTAINER=$1
STATUS=0

function _off {
    if [[ "${CONTAINER}" != "" ]]; then
        echo "[INFO] Power off service ${CONTAINER} ?"
        echo "Please type yes or no and Press [Enter]: "
        read  OP
    else
        echo "[INFO] Power off all services ?"
        echo "Please type yes or no and Press [Enter]: "
        read  OP
    fi

    if [[ $OP == "yes" ]]; then
        docker-compose stop "${CONTAINER}"
    fi
}

if [[ -e "${CURRENT_PATH}/docker-compose.yml" ]]; then
    if ! egrep "${CONTAINER}" "${CURRENT_PATH}/docker-compose.yml" >> /dev/null 2>&1
    then
        echo "[ERROR] Missing container name [${CONAINER}], abort"
        exit
    fi
    cd "${CURRENT_PATH}/"
    STATUS=1
    _off
fi

if [[ -e "${CURRENT_PATH}/web/docker-compose.yml" && "${STATUS}" == 0 ]]; then
    if ! egrep "${CONTAINER}" "${CURRENT_PATH}/web/docker-compose.yml" >> /dev/null 2>&1
    then
        echo "[ERROR] Missing container name [${CONAINER}], abort"
        exit
    fi
    cd "${CURRENT_PATH}/web/"
    STATUS=1
    _off
fi

if [[ ${STATUS} == 0 ]]; then
    echo "Missing docker-compose.yml"
    exit
fi

echo "Off Finished"
exit
